<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amir'O Graphy - Photography Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* All your existing CSS styles remain unchanged */
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* ... (keep all your existing styles) ... */
    </style>
</head>
<body>
    <!-- Your existing HTML structure remains the same -->
    <div class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading your visual journey...</div>
    </div>
    
    <header>
        <!-- ... (keep header content) ... -->
    </header>
    
    <nav>
        <!-- ... (keep navigation) ... -->
    </nav>
    
    <div class="container">
        <!-- All your sections (home, marketplace, feed, profile, about) -->
    </div>
    
    <!-- Modals -->
    <div class="modal" id="login-modal">
        <!-- ... (keep login modal) ... -->
    </div>
    
    <div class="modal" id="subscription-modal">
        <!-- ... (keep subscription modal) ... -->
    </div>
    
    <footer>
        <!-- ... (keep footer) ... -->
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore,
            collection,
            doc,
            setDoc,
            getDoc,
            getDocs,
            addDoc,
            updateDoc,
            serverTimestamp,
            query,
            where,
            orderBy,
            arrayUnion,
            increment
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { 
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // ========================
        // CONFIGURATION SECTION
        // ========================
        
        // 1. Firebase Configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "AIzaSyBN54CFkJqgO_LMu5BUNRkHnxcC56WdD0w",
            authDomain: "amir-o-graphy.firebaseapp.com",
            projectId: "amir-o-graphy",
            storageBucket: "amir-o-graphy.appspot.com",
            messagingSenderId: "632309878901",
            appId: "1:632309878901:web:2454b17fc530624346683c",
            measurementId: "G-YX7ZQ4ZQF2"
        };

        // 2. DeepSeek API Configuration
        const DEEPSEEK_API_KEY = "YOUR_DEEPSEEK_API_KEY_HERE"; // ðŸ‘ˆ Replace with your actual key
        const DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions";

        // ========================
        // INITIALIZATION
        // ========================
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const provider = new GoogleAuthProvider();

        // ========================
        // DEEPSEEK API INTEGRATION
        // ========================
        
        /**
         * Generates photo tags using DeepSeek AI
         * @param {string} description - Photo description/filename
         * @returns {Promise<string[]>} - Array of generated tags
         */
        async function generatePhotoTags(description) {
            try {
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {
                                role: "user",
                                content: `Generate 5 relevant tags for a photography website for this image: "${description}". 
                                          Return only comma-separated keywords, nothing else. 
                                          Example: "landscape,sunset,nature,travel,outdoor"`
                            }
                        ],
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                const tagsString = data.choices[0].message.content;
                return tagsString.split(',').map(tag => tag.trim().toLowerCase());
            } catch (error) {
                console.error("DeepSeek API error:", error);
                // Return default tags if API fails
                return ["photography", "art", "creative", "photo", "image"];
            }
        }

        // ========================
        // PHOTO UPLOAD WITH AI TAGGING
        // ========================
        
        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!auth.currentUser) {
                showLoginModal();
                return;
            }

            try {
                // Show loading state
                const loadingScreen = document.querySelector('.loading-screen');
                loadingScreen.classList.remove('hidden');
                loadingScreen.querySelector('.loading-text').textContent = "Generating AI tags for your photo...";

                // 1. Generate AI tags
                const tags = await generatePhotoTags(file.name);
                
                // 2. Upload to Firebase Storage
                const storageRef = ref(storage, `photos/${auth.currentUser.uid}/${Date.now()}_${file.name}`);
                const uploadTask = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(uploadTask.ref);
                
                // 3. Save to Firestore with AI tags
                await addDoc(collection(db, "photos"), {
                    url: downloadURL,
                    title: file.name.split('.')[0],
                    description: "",
                    tags: tags,
                    price: 0, // Free by default
                    ownerId: auth.currentUser.uid,
                    ownerName: auth.currentUser.displayName,
                    createdAt: serverTimestamp(),
                    downloads: 0,
                    isPublic: true
                });

                // Refresh displays
                loadUserPhotos(auth.currentUser.uid);
                loadCommunityFeed();
                alert("Photo uploaded successfully with AI-generated tags!");
            } catch (error) {
                console.error("Upload error:", error);
                alert("Upload failed: " + error.message);
            } finally {
                // Hide loading screen
                document.querySelector('.loading-screen').classList.add('hidden');
            }
        }

        // ========================
        // REST OF YOUR FIREBASE CODE
        // (All your existing Firebase functions remain unchanged)
        // ========================
        
        // ... (keep all your existing functions like signInWithGoogle, loadMarketplacePhotos, etc) ...

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Set up event listeners
            document.getElementById('google-login').addEventListener('click', signInWithGoogle);
            document.getElementById('photo-upload').addEventListener('change', handlePhotoUpload);
            
            // ... (rest of your initialization code) ...
        });

    </script>
</body>
</html>
